<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Slicer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 1000px; margin: auto; background-color: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #0056b3; text-align: center; margin-bottom: 20px; }
        .info-text { color: #666; font-size: 0.9em; text-align: center; margin-bottom: 25px; }
        
        .controls-wrapper { background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef; }
        .controls { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .full-width { grid-column: 1 / -1; }
        
        label { font-weight: 600; display: block; margin-bottom: 5px; color: #555; font-size: 14px; }
        input[type="file"], input[type="number"], input[type="range"] { width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; }
        
        /* å®æ—¶é¢„è§ˆå»èƒŒåŒºåŸŸ */
        .bg-remove-section {
            grid-column: 1 / -1;
            background-color: #e3f2fd; padding: 20px; border-radius: 6px; border: 1px solid #bbdefb;
            display: flex; gap: 20px; align-items: flex-start;
        }
        .bg-controls { flex: 1; }
        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .color-preview-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 3px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        .eyedropper-btn {
            padding: 5px 10px;
            font-size: 12px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            color: #333;
        }
        .eyedropper-btn.active {
            background: #007bff;
            color: #fff;
            border-color: #0056b3;
        }
        .live-preview-box {
            width: 150px;
            text-align: center;
            background: #fff;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .live-preview-box p { font-size: 12px; margin: 0 0 5px 0; color: #666; font-weight: bold; }
        #livePreviewImg {
            max-width: 100%; height: auto; display: block; margin: auto; border: 1px solid #ccc;
            /* æ£‹ç›˜æ ¼èƒŒæ™¯ */
            background-image: linear-gradient(45deg, #eee 25%, transparent 25%), linear-gradient(-45deg, #eee 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #eee 75%), linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 10px 10px;
        }

        /* è¾¹ç¼˜æ“¦é™¤ */
        .erase-section {
            background-color: #e8f5e9; border: 1px solid #c8e6c9; padding: 15px; border-radius: 6px;
        }
        .trim-inputs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .trim-inputs div { text-align: center; }
        .trim-hint { font-size: 12px; color: #2e7d32; margin-top: 5px; text-align: center; }

        .btn-group { display: flex; gap: 15px; margin-top: 20px; grid-column: 1/-1; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; color: white;}
        #sliceBtn { background-color: #007bff; }
        #sliceBtn:hover:not(:disabled) { background-color: #0056b3; }
        #downloadAllBtn { background-color: #6f42c1; }
        #downloadAllBtn:hover:not(:disabled) { background-color: #59359a; }
        button:disabled { background-color: #e0e0e0; color: #999; cursor: not-allowed; }

        /* å¤§å›¾é¢„è§ˆåŒºåŸŸ */
        #preview-container {
            position: relative; margin-top: 20px; margin-bottom: 30px; border: 2px dashed #ddd; background-color: #fafafa;
            min-height: 200px; display: flex; justify-content: center; padding: 20px; overflow: auto;
        }
        .img-wrapper { position: relative; display: inline-block; line-height: 0; }
        #imagePreview { max-width: 100%; display: block; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        #gridOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none; }
        .grid-line-row { position: absolute; left: 0; width: 100%; border-top: 1px solid rgba(0, 255, 255, 0.8); height: 1px; }
        .grid-line-col { position: absolute; top: 0; height: 100%; border-left: 1px solid rgba(0, 255, 255, 0.8); width: 1px; }

        .slice-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 20px; }
        .slice-item { 
            border: 1px solid #eee; padding: 5px; border-radius: 6px; text-align: center; background: #fff;
            background-image: linear-gradient(45deg, #eee 25%, transparent 25%), linear-gradient(-45deg, #eee 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #eee 75%), linear-gradient(-45deg, transparent 75%, #eee 75%);
            background-size: 10px 10px;
        }
        .slice-item img { max-width: 100%; height: auto; display: block; margin: 0 auto 5px; border: 1px solid #ccc; }
        
        #status { margin-top: 15px; padding: 12px; border-radius: 6px; display: none; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sprite Slicer</h1>
        <p class="info-text">æ‹–åŠ¨æ»‘å—å¯å®æ—¶æŸ¥çœ‹å»èƒŒæ•ˆæœã€‚</p>

        <div class="controls-wrapper">
            <div class="controls">
                <!-- 1. å›¾ç‰‡ä¸Šä¼  -->
                <div class="full-width">
                    <label>1. ä¸Šä¼ å›¾ç‰‡:</label>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>

                <!-- 2. ç½‘æ ¼è®¾ç½® -->
                <div>
                    <label>2. åˆ‡ç‰‡ç½‘æ ¼:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="rows" value="5" min="1" placeholder="è¡Œæ•°">
                        <span style="align-self:center">x</span>
                        <input type="number" id="cols" value="5" min="1" placeholder="åˆ—æ•°">
                    </div>
                </div>

                <!-- 3. è¾¹ç¼˜æ“¦é™¤è®¾ç½® -->
                <div class="erase-section">
                    <label>3. è¾¹ç¼˜æ“¦é™¤ (é€æ˜åŒ–ï¼Œå•ä½ px):</label>
                    <div class="trim-inputs">
                        <div><label>ä¸Š</label><input type="number" id="eraseTop" value="0" min="0"></div>
                        <div><label>ä¸‹</label><input type="number" id="eraseBottom" value="0" min="0"></div>
                        <div><label>å·¦</label><input type="number" id="eraseLeft" value="0" min="0"></div>
                        <div><label>å³</label><input type="number" id="eraseRight" value="0" min="0"></div>
                    </div>
                </div>

                <!-- 4. å»èƒŒè®¾ç½® (å¸¦å®æ—¶é¢„è§ˆ) -->
                <div class="bg-remove-section">
                    <div class="bg-controls">
                        <label style="cursor:pointer; display:flex; align-items:center; gap:5px; margin-bottom: 10px;">
                            <input type="checkbox" id="removeBgCheck"> 
                            <span>4. å¼€å¯å»èƒŒ (å®æ—¶é¢„è§ˆ)</span>
                        </label>
                        
                        <div id="bgSettings" style="opacity:0.5; pointer-events:none;">
                            <div class="color-picker-wrapper">
                                <label style="margin-bottom:0; font-size:13px;">é€‰æ‹©é¢œè‰²:</label>
                                <input type="color" id="bgColorPicker" value="#000000" style="width:40px; height:30px; padding:0; border:none; background:none; cursor:pointer;">
                                <button id="eyedropperBtn" class="eyedropper-btn" title="ç‚¹å‡»ååœ¨å¤§å›¾é¢„è§ˆåŒºåŸŸç‚¹å‡»é€‰å–é¢œè‰²">ğŸ§ª å¸ç®¡å·¥å…·</button>
                                <div id="selectedColorHex" style="font-family:monospace; font-size:12px; color:#666;">#000000</div>
                            </div>

                            <label style="font-size:13px; margin-bottom:5px;">å®¹å·®é˜ˆå€¼ (0-200): <span id="thresholdValue" style="color:#0056b3; font-weight:bold;">30</span></label>
                            <input type="range" id="thresholdRange" min="0" max="200" value="30" style="width:100%">
                            <p style="font-size:12px; color:#666; margin-top:5px;">è°ƒèŠ‚å®¹å·®ä»¥åŒ¹é…ç›¸è¿‘é¢œè‰²ã€‚å¯ç”¨å¸ç®¡ç‚¹å‡»å¤§å›¾å–è‰²ã€‚</p>
                        </div>
                    </div>
                    <!-- å®æ—¶é¢„è§ˆå°çª—å£ -->
                    <div class="live-preview-box">
                        <p>å•ä¸ªåˆ‡ç‰‡æ•ˆæœé¢„è§ˆ</p>
                        <img id="livePreviewImg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="å®æ—¶é¢„è§ˆ">
                    </div>
                </div>

                <!-- æŒ‰é’® -->
                <div class="btn-group">
                    <button id="sliceBtn" disabled>å¼€å§‹ç”Ÿæˆæ‰€æœ‰åˆ‡ç‰‡</button>
                    <button id="downloadAllBtn" disabled>ğŸ“¥ æ‰“åŒ…ä¸‹è½½ (ZIP)</button>
                </div>
            </div>
        </div>

        <div id="status"></div>

        <div id="preview-container">
            <p id="noImageText" style="position: absolute; top: 50%; color: #999;">è¯·å…ˆé€‰æ‹©å›¾ç‰‡</p>
            <div class="img-wrapper" id="imgWrapper" style="display: none;">
                <img id="imagePreview" src="#" alt="é¢„è§ˆ">
                <div id="gridOverlay"></div>
            </div>
        </div>

        <div id="output">
            <div id="sliceGrid" class="slice-grid"></div>
        </div>
    </div>

    <script>
        const els = {
            upload: document.getElementById('imageUpload'),
            preview: document.getElementById('imagePreview'),
            wrapper: document.getElementById('imgWrapper'),
            overlay: document.getElementById('gridOverlay'),
            noImg: document.getElementById('noImageText'),
            rows: document.getElementById('rows'),
            cols: document.getElementById('cols'),
            eraseInputs: ['eraseTop', 'eraseBottom', 'eraseLeft', 'eraseRight'].map(id => document.getElementById(id)),
            sliceBtn: document.getElementById('sliceBtn'),
            dlBtn: document.getElementById('downloadAllBtn'),
            status: document.getElementById('status'),
            grid: document.getElementById('sliceGrid'),
            rmBg: document.getElementById('removeBgCheck'),
            threshRange: document.getElementById('thresholdRange'),
            threshVal: document.getElementById('thresholdValue'),
            bgSettings: document.getElementById('bgSettings'),
            livePreviewImg: document.getElementById('livePreviewImg'),
            bgColorPicker: document.getElementById('bgColorPicker'),
            eyedropperBtn: document.getElementById('eyedropperBtn'),
            selectedColorHex: document.getElementById('selectedColorHex')
        };

        let state = {
            img: null,
            zip: null,
            naturalWidth: 0,
            naturalHeight: 0,
            bgTargetColor: [0, 0, 0], // R, G, B
            isPickingColor: false
        };

        // --- 1. å›¾ç‰‡åŠ è½½ ---
        els.upload.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = evt => {
                els.preview.src = evt.target.result;
                els.wrapper.style.display = 'inline-block';
                els.noImg.style.display = 'none';

                state.img = new Image();
                state.img.onload = () => {
                    state.naturalWidth = state.img.naturalWidth;
                    state.naturalHeight = state.img.naturalHeight;
                    
                    els.sliceBtn.disabled = false;
                    els.dlBtn.disabled = true;
                    els.grid.innerHTML = '';
                    els.status.style.display = 'none';
                    drawGridOverlay();
                    updateLivePreview(); // åŠ è½½å®Œç«‹å³æ˜¾ç¤ºé¢„è§ˆ
                };
                state.img.src = evt.target.result;
            };
            reader.readAsDataURL(file);
        });

        // --- 2. äº¤äº’äº‹ä»¶ç›‘å¬ ---
        // ç½‘æ ¼æ”¹å˜ -> æ›´æ–°å¤§å›¾ç½‘æ ¼çº¿ + æ›´æ–°å°å›¾é¢„è§ˆ
        els.rows.addEventListener('input', () => { drawGridOverlay(); updateLivePreview(); });
        els.cols.addEventListener('input', () => { drawGridOverlay(); updateLivePreview(); });
        
        // æ“¦é™¤æ”¹å˜ -> æ›´æ–°å°å›¾é¢„è§ˆ
        els.eraseInputs.forEach(input => {
            input.addEventListener('input', updateLivePreview);
        });

        // å»èƒŒå¼€å…³
        els.rmBg.addEventListener('change', function() {
            const active = this.checked;
            els.bgSettings.style.opacity = active ? '1' : '0.5';
            els.bgSettings.style.pointerEvents = active ? 'auto' : 'none';
            if (!active && state.isPickingColor) toggleColorPicking(false);
            updateLivePreview();
        });

        // é¢œè‰²é€‰æ‹©å™¨
        els.bgColorPicker.addEventListener('input', function() {
            const hex = this.value;
            els.selectedColorHex.textContent = hex.toUpperCase();
            state.bgTargetColor = hexToRgb(hex);
            updateLivePreview();
        });

        // å¸ç®¡å·¥å…·
        els.eyedropperBtn.addEventListener('click', () => {
            toggleColorPicking(!state.isPickingColor);
        });

        function toggleColorPicking(active) {
            state.isPickingColor = active;
            els.eyedropperBtn.classList.toggle('active', active);
            els.preview.style.cursor = active ? 'crosshair' : 'default';
        }

        // å¤§å›¾ç‚¹å‡»å–è‰²
        els.preview.addEventListener('click', e => {
            if (!state.isPickingColor || !state.img) return;

            const rect = els.preview.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (state.naturalWidth / rect.width);
            const y = (e.clientY - rect.top) * (state.naturalHeight / rect.height);

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1;
            canvas.height = 1;
            ctx.drawImage(state.img, x, y, 1, 1, 0, 0, 1, 1);
            const pixel = ctx.getImageData(0, 0, 1, 1).data;
            
            const hex = rgbToHex(pixel[0], pixel[1], pixel[2]);
            els.bgColorPicker.value = hex;
            els.selectedColorHex.textContent = hex.toUpperCase();
            state.bgTargetColor = [pixel[0], pixel[1], pixel[2]];
            
            toggleColorPicking(false);
            updateLivePreview();
        });

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? [
                parseInt(result[1], 16),
                parseInt(result[2], 16),
                parseInt(result[3], 16)
            ] : [0, 0, 0];
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        // å®¹å·®æ»‘å— -> å®æ—¶æ›´æ–°
        els.threshRange.addEventListener('input', function() {
            els.threshVal.textContent = this.value;
            updateLivePreview(); // æ ¸å¿ƒï¼šæ‹–åŠ¨æ—¶å®æ—¶è§¦å‘
        });

        window.addEventListener('resize', drawGridOverlay);
        els.preview.addEventListener('load', drawGridOverlay);

        // --- 3. è¾…åŠ©åŠŸèƒ½ï¼šç»˜åˆ¶å¤§å›¾ç½‘æ ¼ ---
        function drawGridOverlay() {
            if (!state.img) return;
            const rows = parseInt(els.rows.value) || 1;
            const cols = parseInt(els.cols.value) || 1;
            
            els.overlay.innerHTML = '';
            els.overlay.style.display = 'block';

            for (let r = 1; r < rows; r++) {
                const div = document.createElement('div');
                div.className = 'grid-line-row';
                div.style.top = (r / rows * 100) + '%';
                els.overlay.appendChild(div);
            }
            for (let c = 1; c < cols; c++) {
                const div = document.createElement('div');
                div.className = 'grid-line-col';
                div.style.left = (c / cols * 100) + '%';
                els.overlay.appendChild(div);
            }
        }

        // --- 4. æ ¸å¿ƒåŠŸèƒ½ï¼šå®æ—¶é¢„è§ˆå•å¼ åˆ‡ç‰‡ ---
        function updateLivePreview() {
            if (!state.img) return;

            const rows = parseInt(els.rows.value) || 1;
            const cols = parseInt(els.cols.value) || 1;
            const cellW = state.naturalWidth / cols;
            const cellH = state.naturalHeight / rows;

            // ä¸ºäº†é¢„è§ˆæ›´æœ‰ä»£è¡¨æ€§ï¼Œæˆ‘ä»¬å–ä¸­é—´çš„é‚£ä¸ªæ ¼å­ (Middle Tile)
            const targetRow = Math.floor((rows - 1) / 2);
            const targetCol = Math.floor((cols - 1) / 2);
            
            const srcX = targetCol * cellW;
            const srcY = targetRow * cellH;

            // è·å–å¤„ç†å‚æ•°
            const eTop = parseInt(els.eraseInputs[0].value) || 0;
            const eBottom = parseInt(els.eraseInputs[1].value) || 0;
            const eLeft = parseInt(els.eraseInputs[2].value) || 0;
            const eRight = parseInt(els.eraseInputs[3].value) || 0;
            const removeBg = els.rmBg.checked;
            const threshold = parseInt(els.threshRange.value);

            // åˆ›å»ºä¸´æ—¶ Canvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = cellW;
            canvas.height = cellH;

            // 1. ç»˜åˆ¶
            ctx.drawImage(state.img, srcX, srcY, cellW, cellH, 0, 0, cellW, cellH);

            // 2. æ“¦é™¤è¾¹ç¼˜
            if (eTop > 0) ctx.clearRect(0, 0, cellW, eTop);
            if (eBottom > 0) ctx.clearRect(0, cellH - eBottom, cellW, eBottom);
            if (eLeft > 0) ctx.clearRect(0, 0, eLeft, cellH);
            if (eRight > 0) ctx.clearRect(cellW - eRight, 0, eRight, cellH);

            // 3. å»èƒŒé¢„è§ˆ
            if (removeBg) {
                const frame = ctx.getImageData(0, 0, cellW, cellH);
                const data = frame.data;
                const [tr, tg, tb] = state.bgTargetColor;
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i], g = data[i+1], b = data[i+2];
                    // è®¡ç®—æ¬§å‡ é‡Œå¾—è·ç¦»çš„è¿‘ä¼¼å€¼
                    const diff = Math.sqrt(
                        Math.pow(r - tr, 2) + 
                        Math.pow(g - tg, 2) + 
                        Math.pow(b - tb, 2)
                    );
                    if (diff < threshold) {
                        data[i+3] = 0;
                    }
                }
                ctx.putImageData(frame, 0, 0);
            }

            // æ›´æ–°é¢„è§ˆå›¾
            els.livePreviewImg.src = canvas.toDataURL('image/png');
        }

        // --- 5. æœ€ç»ˆæ‰¹é‡å¤„ç† (ä¸ä¹‹å‰é€»è¾‘ç›¸åŒï¼Œå¾ªç¯æ‰€æœ‰æ ¼å­) ---
        els.sliceBtn.addEventListener('click', () => {
            if (!state.img) return;
            processAllImages();
        });

        els.dlBtn.addEventListener('click', () => {
            if (!state.zip) return;
            showStatus('æ­£åœ¨ç”Ÿæˆ ZIP...', 'info');
            state.zip.generateAsync({type: "blob"}).then(content => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = "slices_final.zip";
                link.click();
                showStatus('ä¸‹è½½å·²å¼€å§‹', 'success');
            });
        });

        function processAllImages() {
            const rows = parseInt(els.rows.value) || 1;
            const cols = parseInt(els.cols.value) || 1;
            const eTop = parseInt(els.eraseInputs[0].value) || 0;
            const eBottom = parseInt(els.eraseInputs[1].value) || 0;
            const eLeft = parseInt(els.eraseInputs[2].value) || 0;
            const eRight = parseInt(els.eraseInputs[3].value) || 0;
            const removeBg = els.rmBg.checked;
            const threshold = parseInt(els.threshRange.value);

            const cellW = state.naturalWidth / cols;
            const cellH = state.naturalHeight / rows;

            els.grid.innerHTML = '';
            els.sliceBtn.disabled = true;
            els.dlBtn.disabled = true;
            showStatus('æ­£åœ¨å¤„ç†å…¨éƒ¨åˆ‡ç‰‡...', 'info');
            state.zip = new JSZip();

            setTimeout(() => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = cellW;
                canvas.height = cellH;
                let count = 0;

                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const srcX = c * cellW;
                        const srcY = r * cellH;

                        ctx.clearRect(0, 0, cellW, cellH);
                        ctx.drawImage(state.img, srcX, srcY, cellW, cellH, 0, 0, cellW, cellH);

                        if (eTop > 0) ctx.clearRect(0, 0, cellW, eTop);
                        if (eBottom > 0) ctx.clearRect(0, cellH - eBottom, cellW, eBottom);
                        if (eLeft > 0) ctx.clearRect(0, 0, eLeft, cellH);
                        if (eRight > 0) ctx.clearRect(cellW - eRight, 0, eRight, cellH);

                        if (removeBg) {
                            const frame = ctx.getImageData(0, 0, cellW, cellH);
                            const data = frame.data;
                            const [tr, tg, tb] = state.bgTargetColor;
                            for (let i = 0; i < data.length; i += 4) {
                                const r = data[i], g = data[i+1], b = data[i+2];
                                const diff = Math.sqrt(
                                    Math.pow(r - tr, 2) + 
                                    Math.pow(g - tg, 2) + 
                                    Math.pow(b - tb, 2)
                                );
                                if (diff < threshold) {
                                    data[i+3] = 0;
                                }
                            }
                            ctx.putImageData(frame, 0, 0);
                        }

                        const dataURL = canvas.toDataURL('image/png');
                        const fileName = `tile_${r+1}_${c+1}.png`;

                        const div = document.createElement('div');
                        div.className = 'slice-item';
                        div.innerHTML = `
                            <img src="${dataURL}">
                            <div style="font-size:12px;color:#666;margin-bottom:2px;">${Math.round(cellW)}x${Math.round(cellH)}</div>
                            <a href="${dataURL}" download="${fileName}" style="text-decoration:none; color:#28a745; font-size:12px; font-weight:bold;">â¬‡ ä¸‹è½½</a>
                        `;
                        els.grid.appendChild(div);
                        state.zip.file(fileName, dataURL.split(',')[1], {base64: true});
                        count++;
                    }
                }
                showStatus(`âœ… å…¨éƒ¨å¤„ç†å®Œæˆï¼Œå…± ${count} å¼ `, 'success');
                els.sliceBtn.disabled = false;
                els.dlBtn.disabled = false;
            }, 50);
        }

        function showStatus(msg, type) {
            els.status.textContent = msg;
            els.status.style.display = 'block';
            els.status.style.backgroundColor = type === 'error' ? '#f8d7da' : (type === 'success' ? '#d4edda' : '#e2e3e5');
            els.status.style.color = type === 'error' ? '#721c24' : (type === 'success' ? '#155724' : '#333');
        }
    </script>
</body>
</html>