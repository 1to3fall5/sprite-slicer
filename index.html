<!-- START OF FILE ai_studio_code (44).html -->

<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Slicer Pro - Precision Grid</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- TGA Loader Support -->
    <script src="https://cdn.jsdelivr.net/gh/magicien/TGAImage@v1.0.0/tgaimage.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="brand">
        <svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M19,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M5,19V5H19V19H5M7,7H17V9H7V7M7,11H17V13H7V11M7,15H17V17H7V15Z" /></svg>
        Sprite <span>Slicer</span>
    </div>
    <button id="themeToggle" class="theme-toggle">
        <svg style="width:16px;height:16px" viewBox="0 0 24 24"><path fill="currentColor" d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z" /></svg>
        主题
    </button>
</header>

<div class="main-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="panel-section">
            <div class="section-title">1. 图片源</div>
            <label class="file-drop-area">
                <!-- 兼容性修复: 明确声明 .tga 扩展名和可能的 MIME 类型 -->
                <input type="file" id="imageUpload" accept="image/*,.tga,image/tga,image/x-tga,image/x-targa">
                <svg class="file-icon" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13.5,16V19H10.5V16H8L12,12L16,16H13.5M13,9V3.5L18.5,9H13Z" /></svg>
                <div class="file-msg" id="fileMsg">
                    点击 / 拖拽 / <kbd>Ctrl+V</kbd><br>上传图片 (支持 TGA)
                </div>
            </label>
        </div>

        <div class="panel-section">
            <div class="section-title">2. 网格初始设置</div>
            <div class="settings-card">
                <div class="grid-inputs-row">
                    <div class="grid-input-item">
                        <label>列</label>
                        <input type="number" id="cols" value="4" min="1">
                    </div>
                    <div class="grid-input-item">
                        <label>行</label>
                        <input type="number" id="rows" value="4" min="1">
                    </div>
                    <button id="resetGridBtn" class="mini-btn" title="重置为均分网格" style="width: 34px; height: 34px;">
                        <svg style="width:18px;height:18px" viewBox="0 0 24 24"><path fill="currentColor" d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" /></svg>
                    </button>
                </div>

                <div class="hint-text">
                    <svg viewBox="0 0 24 24"><path fill="currentColor" d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" /></svg>
                    拖拽画面中的细线可手动调整切割位置
                </div>
            </div>
        </div>

        <div class="panel-section">
            <div class="section-title">3. 边缘修剪 (px)</div>
            <div class="trim-grid">
                <div class="trim-item"><label>上</label><input type="number" id="eraseTop" value="0"></div>
                <div class="trim-item"><label>下</label><input type="number" id="eraseBottom" value="0"></div>
                <div class="trim-item"><label>左</label><input type="number" id="eraseLeft" value="0"></div>
                <div class="trim-item"><label>右</label><input type="number" id="eraseRight" value="0"></div>
            </div>
        </div>

        <div class="panel-section">
            <div class="section-title">4. 智能去背</div>
            <div class="bg-card">
                <label class="toggle-switch">
                    <span style="font-size:14px;">启用去背</span>
                    <input type="checkbox" id="removeBgCheck" style="display:none">
                    <div class="toggle-track"></div>
                </label>
                <div id="bgSettings" style="opacity:0.5; pointer-events:none; transition:0.3s;">
                    <div class="color-tools">
                        <div class="color-preview-btn" style="background:#000" id="colorPreviewBox">
                            <input type="color" id="bgColorPicker" value="#000000">
                        </div>
                        <span id="hexValue" style="font-family:monospace; font-size:12px;">#000000</span>
                        <button id="eyedropperBtn" class="tool-btn">
                            <svg style="width:16px;height:16px" viewBox="0 0 24 24"><path fill="currentColor" d="M2,21L5,21L15,11L12,8L2,18L2,21M17.7,8.3L15.7,6.3L16.7,5.3C17.1,4.9 17.7,4.9 18.1,5.3L18.7,5.9C19.1,6.3 19.1,6.9 18.7,7.3L17.7,8.3Z" /></svg> 吸色
                        </button>
                    </div>
                    <label style="font-size:12px;">容差: <span id="threshDisp">30</span></label>
                    <input type="range" id="threshRange" min="0" max="200" value="30" style="width:100%">
                </div>
            </div>
        </div>

        <div class="action-bar" style="margin-top:auto">
            <button id="dlZipBtn" class="btn btn-primary" disabled>
                <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:currentColor"><path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" /></svg>
                打包下载所有切片 (ZIP)
            </button>
        </div>
    </aside>

    <!-- Workspace -->
    <main class="workspace" id="workspace">
        <div id="emptyState" style="text-align:center; color:var(--text-sub); margin:auto;">
            <svg style="width:64px;height:64px;fill:var(--border)" viewBox="0 0 24 24"><path d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z" /></svg>
            <p>请上传一张图片开始<br><span style="font-size:12px;opacity:0.6">支持 Ctrl+V 粘贴</span></p>
        </div>

        <div class="canvas-container" id="imgWrapper" style="display:none;">
            <canvas id="mainCanvas"></canvas>
            <div id="linesOverlay"></div>
            <div id="cellsOverlay"></div>
        </div>

        <!-- 视图控制工具栏 -->
        <div id="viewControls">
        <button class="view-btn" id="zoomOutBtn" title="缩小"><svg viewBox="0 0 24 24"><path d="M19,13H5V11H19V13Z" /></svg></button>
        <span id="zoomLevel" style="font-size:12px; font-weight:600; min-width:36px; text-align:center; color:var(--text-main)">100%</span>
        <button class="view-btn" id="zoomInBtn" title="放大"><svg viewBox="0 0 24 24"><path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" /></svg></button>
        <button class="view-btn" id="resetViewBtn" title="重置视图"><svg viewBox="0 0 24 24"><path d="M5,5H10V7H7V10H5V5M19,5H14V7H17V10H19V5M19,19H14V17H17V14H19V19M5,19H10V17H7V14H5V19Z" /></svg></button>
        <div style="width:1px;height:16px;background:var(--border);margin:0 4px"></div>
        <button class="view-btn active" id="toggleGridBtn" title="显示/隐藏网格">
            <svg viewBox="0 0 24 24"><path d="M4,4H20V20H4V4 M6,6V11H11V6H6 M13,6V11H18V6H13 M6,13V18H11V13H6 M13,13V18H18V13H13 Z" /></svg>
        </button>
        <button class="view-btn active" id="toggleMaskBtn" title="显示/隐藏去背效果 (对比原图)">
            <svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20V4Z" /></svg>
        </button>
    </div>
    </main>
</div>

<!-- Modal & Toast -->
<div id="viewModal" class="modal-overlay">
    <div class="modal-content">
        <button onclick="closeModal()" class="modal-close-btn-top" title="关闭">
            <svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
        </button>
        <div class="modal-img-viewport" id="modalViewport">
            <img id="modalImg" src="" draggable="false">
        </div>
        <div id="modalControls">
            <button class="view-btn" onclick="resetModalZoom()" title="复位大小">
                <svg viewBox="0 0 24 24"><path d="M5,5H10V7H7V10H5V5M19,5H14V7H17V10H19V5M19,19H14V17H17V14H19V19M5,19H10V17H7V14H5V19Z" /></svg>
            </button>
            <div style="width:1px;height:16px;background:var(--border);margin:0 4px"></div>
            <button class="view-btn" onclick="copyModalImage()" title="复制图片">
                <svg viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" /></svg>
            </button>
            <button class="view-btn" id="modalDlBtn" title="下载图片">
                <svg viewBox="0 0 24 24"><path d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" /></svg>
            </button>
        </div>
    </div>
</div>
<div id="status-toast"></div>

<script src="script.js"></script>
</body>
</html>